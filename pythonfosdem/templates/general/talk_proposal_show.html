{% extends 'layout.html' %}

{% block content %}
<div class="page-header">
    <h2>{{ _('Proposal') }}</h2>
</div>
<div class='row'>
    <div class='span12'>
        <table class='table table-striped table-condensed table-bordered'>
            <tr>
                <th>Title</th>
                <td>{{ talk_proposal.title }}</td>
            </tr>
            <tr>
                <th>Description</th>
                <td>{{ talk_proposal.description }}</td>
            </tr>
            <tr>
                <th>Firstname</th>
                <td>{{ talk_proposal.firstname }}</td>
            </tr>
            <tr>
                <th>Lastname</th>
                <td>{{ talk_proposal.lastname }}</td>
            </tr>
            <tr>
                <th>Company</th>
                <td>{{ talk_proposal.company }}</td>
            </tr>
            <tr>
                <th>Biography</th>
                <td>{{ talk_proposal.biography }}</td>
            </tr>
            <tr>
                <th>Twitter</th>
                <td>{{ talk_proposal.twitter }}</td>
            </tr>
            <tr>
                <th>Email</th>
                <td>{{ talk_proposal.email }}</td>
            </tr>
            <tr>
                <th>Site</th>
                <td>{{ talk_proposal.site_url }}</td>
            </tr>
        </table>
        {% if current_user.has_role('jury_member') %}
        <div class="btn-group">
            <a href="#"
                data-model-id="{{ talk_proposal.id }}" data-vote='up'
                class="on-vote btn btn-success btn-small"><i class="icon-arrow-up"></i> {{ _('Vote Up') }}</a>

            <a href="#"
                data-model-id="{{ talk_proposal.id }}" data-vote='down'
                class="on-vote btn btn-danger btn-small"><i class="icon-arrow-down"></i> {{ _('Vote Down') }}</a>
        </div>
        {% endif %}
    </div>
</div>

{% endblock %}

{%- block final_js %}
    {{ super() }}


    <script>
    $(function() {
        var pythonfosdem = {
            ajax_post: function(url, params, on_success) {
                var _callback = function(response) {
                    if (response.success) {
                        if (response.redirect_url) {
                            window.location.href = response.redirect_url;
                        }
                        else if (response.reload) {
                            window.location.reload();
                        }
                        else if (on_success) {
                            return on_success(response);
                        }
                    } else {
                        // Error handling
                    }
                };
                $.post(url, params, _callback, 'json');
            }
        };

        $('a.on-vote').each(function(index, item) {
            $(item).on('click', function(event) {
                event.preventDefault();
                var record_id = $(this).data('model-id'),
                    vote = $(this).data('vote');

                var params = {
                    record_id: record_id,
                    vote: vote,
                }

                pythonfosdem.ajax_post('{{ url_for("general.talk_proposal_vote") }}', params, function(response) {
                    console.log(response);
                });
            });

        });
    });
    </script>

{%- endblock %}
